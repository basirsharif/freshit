<h2><%= @topic.name %></h1>


<% if can? :update, @topic %>
  <%= link_to "Edit Topic", edit_topic_path, class: 'btn btn-primary btn-mini' %>
<% end %>

<div class="row">
  <div class="col-md-4 .col-md-offset-4 col-sm-4 .col-sm-offset-4 col-lg-4 .col-lg-offset-4">
    <p class="lead"><%= @topic.description %></p>
    <%= render @posts %>
    <%= will_paginate @posts %>
  </div>
  <div class="span4">
    <% if can? :create, Post %>
      <%= link_to "New Resource", new_topic_post_path(@topic), class: 'btn btn-large btn-block' %>
    <% end %>

    <% if can? :destroy, @topic %>
      <%= link_to "Delete Topic", @topic, method: :delete, class: 'btn btn-large btn-block btn-danger', confirm: 'Are you sure you want to delete this topic?' %>
    <% end %> 
  </div>
</div>

<% content_for :page_scripts do %>
  <script> 

  $(document).ready(function (){
    console.log("Loading script....");
      // track a client-side event using the Blocmetrics analytics service
    var _bm_event = {
      name: "Page Views",
      application: "Bloccit",
      topic_name: "<%= @topic.name %>",
      app_user: "<%= current_user ? current_user.id : 0 %>", // --> where 0 represents non-user activity
      app_owner: "douglaswalter2@gmail.com" // admin, general email to synch app with Blocmetrics view for app_owner  
    }

    console.log("_bm_event created");

    var _bm_request = new XMLHttpRequest();
    _bm_request.open("POST", "http://freshimetrics.herokuapp.com/events.json", true);
    _bm_request.setRequestHeader('Content-Type', 'application/json');
    _bm_request.onreadystatechange = function() {
      // this function runs when the Ajax request changes state.
      // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
      console.log("Freshimetrics event received!");
    };
    _bm_request.send(JSON.stringify(_bm_event));
    console.log("request sent!");
  }());</script>
<% end %>
